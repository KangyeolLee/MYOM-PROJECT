{"ast":null,"code":"import _objectSpread from \"/Users/JeHongHwang/Desktop/leekang/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nvar _jsxFileName = \"/Users/JeHongHwang/Desktop/leekang/src/components/community/CommunityDashboard.js\";\nimport React, { Component } from 'react';\nimport SideNavTest from './SideNavTest';\nimport PostList from './PostList';\nimport M from 'materialize-css';\nimport { Link } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport { firestoreConnect, isLoaded, isEmpty } from 'react-redux-firebase';\nimport { compose } from 'redux';\nimport './community.css';\nimport Preloader from '../functionalComponents/Preloader';\n\nclass CommunityDashboard extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      limit_list: 12,\n      morePosts: [],\n      nextRef: null,\n      loading: true\n    };\n\n    this.infiniteScroll = () => {\n      let scrollHeight = Math.max(document.documentElement.scrollHeight, document.body.scrollHeight);\n      let scrollTop = Math.max(document.documentElement.scrollTop, document.body.scrollTop);\n      let clientHeight = document.documentElement.clientHeight;\n\n      if (scrollTop + clientHeight === scrollHeight) {\n        this.loadMorePosts();\n      }\n    };\n\n    this.loadMorePosts = async () => {\n      const firestore = this.props.firestore;\n      const _this$state = this.state,\n            limit_list = _this$state.limit_list,\n            nextRef = _this$state.nextRef;\n\n      if (!nextRef) {\n        const firstQuery = firestore.collection('posts').where('category', '==', this.props.match.params.category).orderBy('createAt', 'desc').limit(limit_list);\n        const firstSnaps = await firstQuery.get();\n        const firstVisible = firstSnaps.docs[firstSnaps.size - 1];\n        this.setState({\n          nextRef: firstVisible\n        });\n      }\n\n      try {\n        const nextQuery = firestore.collection('posts').where('category', '==', this.props.match.params.category).orderBy('createAt', 'desc').startAfter(this.state.nextRef).limit(limit_list);\n        const nextSnaps = await nextQuery.get();\n        const nextVisible = nextSnaps.docs[nextSnaps.size - 1];\n\n        if (!nextVisible) {\n          this.setState({\n            loading: false\n          });\n          return;\n        }\n\n        const loadedPosts = nextSnaps.docs.map(doc => {\n          const id = doc.id;\n          const data = doc.data();\n          return _objectSpread({\n            id\n          }, data);\n        });\n        return this.setState({\n          morePosts: [...this.state.morePosts, ...loadedPosts],\n          nextRef: nextVisible\n        });\n      } catch (err) {\n        console.log('error : ', err);\n      }\n    };\n  }\n\n  componentDidMount() {\n    M.AutoInit();\n    window.addEventListener('scroll', this.infiniteScroll, true);\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (this.props.posts !== nextProps.posts) {\n      this.setState({\n        morePosts: nextProps.posts\n      });\n    }\n  }\n\n  render() {\n    const _this$props = this.props,\n          posts = _this$props.posts,\n          profile = _this$props.profile,\n          match = _this$props.match,\n          auth = _this$props.auth;\n    const morePosts = this.state.morePosts;\n    return React.createElement(\"div\", {\n      className: \"communityDashboard\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 86\n      },\n      __self: this\n    }, React.createElement(SideNavTest, {\n      profile: profile,\n      auth: auth,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 87\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"communityTemplate\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 88\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"contents\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 89\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"post-list\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 90\n      },\n      __self: this\n    }, !isLoaded(posts) ? React.createElement(Preloader, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 93\n      },\n      __self: this\n    }) : isEmpty(morePosts) ? React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95\n      },\n      __self: this\n    }, \"\\uB4F1\\uB85D\\uB41C \\uD3EC\\uC2A4\\uD2B8\\uAC00 \\uC5C6\\uC2B5\\uB2C8\\uB2E4. \") : morePosts.map(post => {\n      return React.createElement(PostList, {\n        post: post,\n        post_id: post.id,\n        key: post.id,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 98\n        },\n        __self: this\n      });\n    })))), React.createElement(\"div\", {\n      className: \"fixed-action-btn\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 105\n      },\n      __self: this\n    }, profile.authority === match.params.category && React.createElement(Link, {\n      to: `${match.url}` + '/createPost',\n      className: \"btn-floating btn-large indigo\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 107\n      },\n      __self: this\n    }, React.createElement(\"i\", {\n      className: \"large material-icons myomColor-background\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 108\n      },\n      __self: this\n    }, \"mode_edit\"))));\n  }\n\n}\n\nconst mapStateToProps = state => {\n  return {\n    posts: state.firestore.ordered.posts,\n    profile: state.firebase.profile,\n    auth: state.firebase.auth\n  };\n};\n\nexport default compose(connect(mapStateToProps), firestoreConnect(props => {\n  return [{\n    collection: 'posts',\n    where: ['category', '==', props.match.params.category],\n    orderBy: ['createAt', 'desc'],\n    limit: 12\n  }];\n}))(CommunityDashboard);","map":{"version":3,"sources":["/Users/JeHongHwang/Desktop/leekang/src/components/community/CommunityDashboard.js"],"names":["React","Component","SideNavTest","PostList","M","Link","connect","firestoreConnect","isLoaded","isEmpty","compose","Preloader","CommunityDashboard","state","limit_list","morePosts","nextRef","loading","infiniteScroll","scrollHeight","Math","max","document","documentElement","body","scrollTop","clientHeight","loadMorePosts","firestore","props","firstQuery","collection","where","match","params","category","orderBy","limit","firstSnaps","get","firstVisible","docs","size","setState","nextQuery","startAfter","nextSnaps","nextVisible","loadedPosts","map","doc","id","data","err","console","log","componentDidMount","AutoInit","window","addEventListener","componentWillReceiveProps","nextProps","posts","render","profile","auth","post","authority","url","mapStateToProps","ordered","firebase"],"mappings":";;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,OAAOC,WAAP,MAAwB,eAAxB;AACA,OAAOC,QAAP,MAAqB,YAArB;AACA,OAAOC,CAAP,MAAc,iBAAd;AACA,SAAQC,IAAR,QAAmB,kBAAnB;AACA,SAASC,OAAT,QAAwB,aAAxB;AACA,SAASC,gBAAT,EAA2BC,QAA3B,EAAqCC,OAArC,QAAoD,sBAApD;AACA,SAASC,OAAT,QAAwB,OAAxB;AACA,OAAO,iBAAP;AACA,OAAOC,SAAP,MAAsB,mCAAtB;;AAEA,MAAMC,kBAAN,SAAiCX,SAAjC,CAA2C;AAAA;AAAA;AAAA,SAC1CY,KAD0C,GAClC;AACPC,MAAAA,UAAU,EAAG,EADN;AAEPC,MAAAA,SAAS,EAAE,EAFJ;AAGPC,MAAAA,OAAO,EAAE,IAHF;AAIPC,MAAAA,OAAO,EAAE;AAJF,KADkC;;AAAA,SAoB1CC,cApB0C,GAoBzB,MAAM;AACtB,UAAIC,YAAY,GAAGC,IAAI,CAACC,GAAL,CAASC,QAAQ,CAACC,eAAT,CAAyBJ,YAAlC,EAAgDG,QAAQ,CAACE,IAAT,CAAcL,YAA9D,CAAnB;AACA,UAAIM,SAAS,GAAGL,IAAI,CAACC,GAAL,CAASC,QAAQ,CAACC,eAAT,CAAyBE,SAAlC,EAA6CH,QAAQ,CAACE,IAAT,CAAcC,SAA3D,CAAhB;AACA,UAAIC,YAAY,GAAGJ,QAAQ,CAACC,eAAT,CAAyBG,YAA5C;;AACA,UAAGD,SAAS,GAAGC,YAAZ,KAA6BP,YAAhC,EAA6C;AAC5C,aAAKQ,aAAL;AACA;AACD,KA3ByC;;AAAA,SA6B1CA,aA7B0C,GA6B1B,YAAY;AAAA,YACnBC,SADmB,GACL,KAAKC,KADA,CACnBD,SADmB;AAAA,0BAEK,KAAKf,KAFV;AAAA,YAEnBC,UAFmB,eAEnBA,UAFmB;AAAA,YAEPE,OAFO,eAEPA,OAFO;;AAI3B,UAAG,CAACA,OAAJ,EAAY;AACX,cAAMc,UAAU,GAAGF,SAAS,CAACG,UAAV,CAAqB,OAArB,EAA8BC,KAA9B,CAAoC,UAApC,EAAgD,IAAhD,EAAsD,KAAKH,KAAL,CAAWI,KAAX,CAAiBC,MAAjB,CAAwBC,QAA9E,EACjBC,OADiB,CACT,UADS,EACG,MADH,EACWC,KADX,CACiBvB,UADjB,CAAnB;AAED,cAAMwB,UAAU,GAAG,MAAMR,UAAU,CAACS,GAAX,EAAzB;AACA,cAAMC,YAAY,GAAGF,UAAU,CAACG,IAAX,CAAgBH,UAAU,CAACI,IAAX,GAAkB,CAAlC,CAArB;AAEA,aAAKC,QAAL,CAAc;AACb3B,UAAAA,OAAO,EAAEwB;AADI,SAAd;AAGC;;AACD,UAAG;AACF,cAAMI,SAAS,GAAGhB,SAAS,CAACG,UAAV,CAAqB,OAArB,EAA8BC,KAA9B,CAAoC,UAApC,EAAgD,IAAhD,EAAsD,KAAKH,KAAL,CAAWI,KAAX,CAAiBC,MAAjB,CAAwBC,QAA9E,EAChBC,OADgB,CACR,UADQ,EACI,MADJ,EACYS,UADZ,CACuB,KAAKhC,KAAL,CAAWG,OADlC,EAC2CqB,KAD3C,CACiDvB,UADjD,CAAlB;AAEA,cAAMgC,SAAS,GAAG,MAAMF,SAAS,CAACL,GAAV,EAAxB;AACA,cAAMQ,WAAW,GAAGD,SAAS,CAACL,IAAV,CAAeK,SAAS,CAACJ,IAAV,GAAgB,CAA/B,CAApB;;AAEA,YAAG,CAACK,WAAJ,EAAgB;AACf,eAAKJ,QAAL,CAAc;AACb1B,YAAAA,OAAO,EAAE;AADI,WAAd;AAGA;AACA;;AAED,cAAM+B,WAAW,GAAGF,SAAS,CAACL,IAAV,CAAeQ,GAAf,CAAmBC,GAAG,IAAI;AAC7C,gBAAMC,EAAE,GAAGD,GAAG,CAACC,EAAf;AACA,gBAAMC,IAAI,GAAGF,GAAG,CAACE,IAAJ,EAAb;AACA;AAAQD,YAAAA;AAAR,aAAeC,IAAf;AACA,SAJmB,CAApB;AAMA,eAAO,KAAKT,QAAL,CAAc;AACpB5B,UAAAA,SAAS,EAAG,CAAC,GAAG,KAAKF,KAAL,CAAWE,SAAf,EAA0B,GAAGiC,WAA7B,CADQ;AAEpBhC,UAAAA,OAAO,EAAE+B;AAFW,SAAd,CAAP;AAIA,OAvBD,CAuBE,OAAMM,GAAN,EAAW;AACZC,QAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ,EAAwBF,GAAxB;AACA;AACD,KArEyC;AAAA;;AAO1CG,EAAAA,iBAAiB,GAAE;AAClBpD,IAAAA,CAAC,CAACqD,QAAF;AACAC,IAAAA,MAAM,CAACC,gBAAP,CAAwB,QAAxB,EAAkC,KAAKzC,cAAvC,EAAuD,IAAvD;AACA;;AAED0C,EAAAA,yBAAyB,CAACC,SAAD,EAAY;AACpC,QAAG,KAAKhC,KAAL,CAAWiC,KAAX,KAAqBD,SAAS,CAACC,KAAlC,EAAyC;AACxC,WAAKnB,QAAL,CAAc;AACb5B,QAAAA,SAAS,EAAE8C,SAAS,CAACC;AADR,OAAd;AAGA;AACD;;AAoDDC,EAAAA,MAAM,GAAE;AAAA,wBACiC,KAAKlC,KADtC;AAAA,UACCiC,KADD,eACCA,KADD;AAAA,UACQE,OADR,eACQA,OADR;AAAA,UACiB/B,KADjB,eACiBA,KADjB;AAAA,UACwBgC,IADxB,eACwBA,IADxB;AAAA,UAEClD,SAFD,GAEe,KAAKF,KAFpB,CAECE,SAFD;AAGP,WACC;AAAK,MAAA,SAAS,EAAC,oBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACC,oBAAC,WAAD;AAAa,MAAA,OAAO,EAAEiD,OAAtB;AAA+B,MAAA,IAAI,EAAEC,IAArC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADD,EAEC;AAAK,MAAA,SAAS,EAAC,mBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACC;AAAK,MAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACC;AAAK,MAAA,SAAS,EAAC,WAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAEC,CAACzD,QAAQ,CAACsD,KAAD,CAAT,GACG,oBAAC,SAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADH,GAEGrD,OAAO,CAACM,SAAD,CAAP,GACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gFADA,GAEAA,SAAS,CAACkC,GAAV,CAAciB,IAAI,IAAI;AACtB,aACC,oBAAC,QAAD;AAAU,QAAA,IAAI,EAAGA,IAAjB;AAAuB,QAAA,OAAO,EAAGA,IAAI,CAACf,EAAtC;AAA0C,QAAA,GAAG,EAAEe,IAAI,CAACf,EAApD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADD;AAGA,KAJA,CANJ,CADD,CADD,CAFD,EAmBC;AAAK,MAAA,SAAS,EAAC,kBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACIa,OAAO,CAACG,SAAR,KAAsBlC,KAAK,CAACC,MAAN,CAAaC,QAApC,IACF,oBAAC,IAAD;AAAM,MAAA,EAAE,EAAG,GAAEF,KAAK,CAACmC,GAAI,EAAb,GAAe,aAAzB;AAAwC,MAAA,SAAS,EAAC,+BAAlD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACC;AAAG,MAAA,SAAS,EAAC,2CAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBADD,CAFD,CAnBD,CADD;AA8BA;;AAvGyC;;AA0G3C,MAAMC,eAAe,GAAIxD,KAAD,IAAW;AAClC,SAAM;AACLiD,IAAAA,KAAK,EAAEjD,KAAK,CAACe,SAAN,CAAgB0C,OAAhB,CAAwBR,KAD1B;AAELE,IAAAA,OAAO,EAAEnD,KAAK,CAAC0D,QAAN,CAAeP,OAFnB;AAGLC,IAAAA,IAAI,EAAEpD,KAAK,CAAC0D,QAAN,CAAeN;AAHhB,GAAN;AAKA,CAND;;AAQA,eAAevD,OAAO,CACrBJ,OAAO,CAAC+D,eAAD,CADc,EAErB9D,gBAAgB,CAAEsB,KAAD,IAAW;AAC3B,SAAO,CAAC;AAAEE,IAAAA,UAAU,EAAE,OAAd;AAAuBC,IAAAA,KAAK,EAAE,CAAC,UAAD,EAAa,IAAb,EAAmBH,KAAK,CAACI,KAAN,CAAYC,MAAZ,CAAmBC,QAAtC,CAA9B;AAAgFC,IAAAA,OAAO,EAAE,CAAC,UAAD,EAAY,MAAZ,CAAzF;AAA8GC,IAAAA,KAAK,EAAE;AAArH,GAAD,CAAP;AACA,CAFe,CAFK,CAAP,CAKbzB,kBALa,CAAf","sourcesContent":["import React, { Component } from 'react'\nimport SideNavTest from './SideNavTest'\nimport PostList from './PostList'\nimport M from 'materialize-css'\nimport {Link} from 'react-router-dom'\nimport { connect } from 'react-redux'\nimport { firestoreConnect, isLoaded, isEmpty } from 'react-redux-firebase'\nimport { compose } from 'redux'\nimport './community.css'\nimport Preloader from '../functionalComponents/Preloader';\n\nclass CommunityDashboard extends Component {\n\tstate = {\n\t\tlimit_list : 12,\n\t\tmorePosts: [],\n\t\tnextRef: null,\n\t\tloading: true,\n\t}\n\tcomponentDidMount(){\n\t\tM.AutoInit();\n\t\twindow.addEventListener('scroll', this.infiniteScroll, true);\n\t}\n\n\tcomponentWillReceiveProps(nextProps) {\n\t\tif(this.props.posts !== nextProps.posts) {\n\t\t\tthis.setState({\n\t\t\t\tmorePosts: nextProps.posts,\n\t\t\t})\n\t\t}\n\t}\n\n\tinfiniteScroll = () => {\n\t\tlet scrollHeight = Math.max(document.documentElement.scrollHeight, document.body.scrollHeight);\n\t\tlet scrollTop = Math.max(document.documentElement.scrollTop, document.body.scrollTop);\n\t\tlet clientHeight = document.documentElement.clientHeight;\n\t\tif(scrollTop + clientHeight === scrollHeight){\n\t\t\tthis.loadMorePosts();\n\t\t}\n\t}\n\n\tloadMorePosts = async () => {\n\t\tconst { firestore } = this.props;\n\t\tconst { limit_list, nextRef } = this.state;\n\n\t\tif(!nextRef){\n\t\t\tconst firstQuery = firestore.collection('posts').where('category', '==', this.props.match.params.category )\n\t\t\t\t.orderBy('createAt', 'desc').limit(limit_list);\n\t\tconst firstSnaps = await firstQuery.get();\n\t\tconst firstVisible = firstSnaps.docs[firstSnaps.size - 1];\n\n\t\tthis.setState({\n\t\t\tnextRef: firstVisible,\n\t\t})\n\t\t}\n\t\ttry{\n\t\t\tconst nextQuery = firestore.collection('posts').where('category', '==', this.props.match.params.category )\n\t\t\t\t.orderBy('createAt', 'desc').startAfter(this.state.nextRef).limit(limit_list);\n\t\t\tconst nextSnaps = await nextQuery.get();\n\t\t\tconst nextVisible = nextSnaps.docs[nextSnaps.size -1]\n\n\t\t\tif(!nextVisible){\n\t\t\t\tthis.setState({\n\t\t\t\t\tloading: false,\n\t\t\t\t})\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst loadedPosts = nextSnaps.docs.map(doc => {\n\t\t\t\tconst id = doc.id;\n\t\t\t\tconst data = doc.data();\n\t\t\t\treturn {id, ...data }\n\t\t\t})\n\n\t\t\treturn this.setState({\n\t\t\t\tmorePosts : [...this.state.morePosts, ...loadedPosts],\n\t\t\t\tnextRef: nextVisible,\n\t\t\t})\n\t\t} catch(err) {\n\t\t\tconsole.log('error : ', err);\n\t\t}\n\t}\n\trender(){\n\t\tconst { posts, profile, match, auth } = this.props;\n\t\tconst { morePosts } = this.state;\n\t\treturn(\n\t\t\t<div className=\"communityDashboard\">\n\t\t\t\t<SideNavTest profile={profile} auth={auth} />\n\t\t\t\t<div className=\"communityTemplate\">\n\t\t\t\t\t<div className=\"contents\">\n\t\t\t\t\t\t<div className=\"post-list\">\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t!isLoaded(posts)\n\t\t\t\t\t\t\t\t? <Preloader/>\n\t\t\t\t\t\t\t\t: isEmpty(morePosts)\n\t\t\t\t\t\t\t\t? <div>등록된 포스트가 없습니다. </div>\n\t\t\t\t\t\t\t\t: morePosts.map(post => {\t\n\t\t\t\t\t\t\t\t\t\treturn(\n\t\t\t\t\t\t\t\t\t\t\t<PostList post= {post} post_id= {post.id} key={post.id}/>\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t}) \n\t\t\t\t\t\t}\t\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"fixed-action-btn\">\n\t\t\t\t\t{ (profile.authority === match.params.category) && \n\t\t\t\t\t<Link to={`${match.url}`+'/createPost'} className=\"btn-floating btn-large indigo\">\n\t\t\t\t\t\t<i className=\"large material-icons myomColor-background\">mode_edit</i>\n\t\t\t\t\t</Link>\n\t\t\t\t\t}\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t)\n\t}\n}\n\nconst mapStateToProps = (state) => {\n\treturn{\n\t\tposts: state.firestore.ordered.posts,\n\t\tprofile: state.firebase.profile,\n\t\tauth: state.firebase.auth,\n\t}\n}\n\nexport default compose(\n\tconnect(mapStateToProps),\n\tfirestoreConnect((props) => {\n\t\treturn [{ collection: 'posts', where: ['category', '==', props.match.params.category ], orderBy: ['createAt','desc'], limit: 12 }]\n\t}),\n)(CommunityDashboard);"]},"metadata":{},"sourceType":"module"}