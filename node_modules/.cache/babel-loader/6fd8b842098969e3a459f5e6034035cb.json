{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.firestoreRef = firestoreRef;\nexports.getQueryName = getQueryName;\nexports.getBaseQueryName = getBaseQueryName;\nexports.listenerExists = listenerExists;\nexports.attachListener = attachListener;\nexports.detachListener = detachListener;\nexports.queryStrToObj = queryStrToObj;\nexports.getQueryConfig = getQueryConfig;\nexports.getQueryConfigs = getQueryConfigs;\nexports.orderedFromSnap = orderedFromSnap;\nexports.dataByIdSnapshot = dataByIdSnapshot;\nexports.getPopulateChild = getPopulateChild;\nexports.populateList = populateList;\nexports.promisesForPopulate = promisesForPopulate;\nexports.dispatchListenerResponse = dispatchListenerResponse;\nexports.getPopulateActions = getPopulateActions;\n\nvar _cloneDeep2 = _interopRequireDefault(require(\"lodash/cloneDeep\"));\n\nvar _some2 = _interopRequireDefault(require(\"lodash/some\"));\n\nvar _set2 = _interopRequireDefault(require(\"lodash/set\"));\n\nvar _get2 = _interopRequireDefault(require(\"lodash/get\"));\n\nvar _map2 = _interopRequireDefault(require(\"lodash/map\"));\n\nvar _has2 = _interopRequireDefault(require(\"lodash/has\"));\n\nvar _forEach2 = _interopRequireDefault(require(\"lodash/forEach\"));\n\nvar _trim2 = _interopRequireDefault(require(\"lodash/trim\"));\n\nvar _size2 = _interopRequireDefault(require(\"lodash/size\"));\n\nvar _isEmpty2 = _interopRequireDefault(require(\"lodash/isEmpty\"));\n\nvar _isNumber2 = _interopRequireDefault(require(\"lodash/isNumber\"));\n\nvar _isObject2 = _interopRequireDefault(require(\"lodash/isObject\"));\n\nvar _isFunction2 = _interopRequireDefault(require(\"lodash/isFunction\"));\n\nvar _isArray2 = _interopRequireDefault(require(\"lodash/isArray\"));\n\nvar _isString2 = _interopRequireDefault(require(\"lodash/isString\"));\n\nvar _constants = require(\"../constants\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _toArray(arr) {\n  return _arrayWithHoles(arr) || _iterableToArray(arr) || _nonIterableRest();\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    var ownKeys = Object.keys(source);\n\n    if (typeof Object.getOwnPropertySymbols === 'function') {\n      ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n      }));\n    }\n\n    ownKeys.forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    });\n  }\n\n  return target;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}\n\nfunction addWhereToRef(ref, where) {\n  if (!(0, _isArray2.default)(where)) {\n    throw new Error('where parameter must be an array.');\n  }\n\n  if ((0, _isString2.default)(where[0])) {\n    return where.length > 1 ? ref.where.apply(ref, _toConsumableArray(where)) : ref.where(where[0]);\n  }\n\n  return where.reduce(function (acc, whereArgs) {\n    return addWhereToRef(acc, whereArgs);\n  }, ref);\n}\n\nfunction addOrderByToRef(ref, orderBy) {\n  if (!(0, _isArray2.default)(orderBy) && !(0, _isString2.default)(orderBy)) {\n    throw new Error('orderBy parameter must be an array or string.');\n  }\n\n  if ((0, _isString2.default)(orderBy)) {\n    return ref.orderBy(orderBy);\n  }\n\n  if ((0, _isString2.default)(orderBy[0])) {\n    return ref.orderBy.apply(ref, _toConsumableArray(orderBy));\n  }\n\n  return orderBy.reduce(function (acc, orderByArgs) {\n    return addOrderByToRef(acc, orderByArgs);\n  }, ref);\n}\n\nfunction handleSubcollections(ref, subcollectionList) {\n  if (subcollectionList) {\n    (0, _forEach2.default)(subcollectionList, function (subcollection) {\n      if (subcollection.collection) {\n        if (!(0, _isFunction2.default)(ref.collection)) {\n          throw new Error(\"Collection can only be run on a document. Check that query config for subcollection: \\\"\".concat(subcollection.collection, \"\\\" contains a doc parameter.\"));\n        }\n\n        ref = ref.collection(subcollection.collection);\n      }\n\n      if (subcollection.doc) ref = ref.doc(subcollection.doc);\n      if (subcollection.where) ref = addWhereToRef(ref, subcollection.where);\n\n      if (subcollection.orderBy) {\n        ref = addOrderByToRef(ref, subcollection.orderBy);\n      }\n\n      if (subcollection.limit) ref = ref.limit(subcollection.limit);\n      if (subcollection.startAt) ref = ref.startAt(subcollection.startAt);\n\n      if (subcollection.startAfter) {\n        ref = ref.startAfter(subcollection.startAfter);\n      }\n\n      if (subcollection.endAt) ref = ref.endAt(subcollection.endAt);\n      if (subcollection.endBefore) ref = ref.endBefore(subcollection.endBefore);\n      ref = handleSubcollections(ref, subcollection.subcollections);\n    });\n  }\n\n  return ref;\n}\n\nfunction firestoreRef(firebase, meta) {\n  if (!firebase.firestore) {\n    throw new Error('Firestore must be required and initalized.');\n  }\n\n  var collection = meta.collection,\n      doc = meta.doc,\n      subcollections = meta.subcollections,\n      where = meta.where,\n      orderBy = meta.orderBy,\n      limit = meta.limit,\n      startAt = meta.startAt,\n      startAfter = meta.startAfter,\n      endAt = meta.endAt,\n      endBefore = meta.endBefore;\n  var ref = firebase.firestore().collection(collection);\n  if (doc) ref = ref.doc(doc);\n  ref = handleSubcollections(ref, subcollections);\n  if (where) ref = addWhereToRef(ref, where);\n  if (orderBy) ref = addOrderByToRef(ref, orderBy);\n  if (limit) ref = ref.limit(limit);\n  if (startAt) ref = ref.startAt(startAt);\n  if (startAfter) ref = ref.startAfter(startAfter);\n  if (endAt) ref = ref.endAt(endAt);\n  if (endBefore) ref = ref.endBefore(endBefore);\n  return ref;\n}\n\nfunction arrayToStr(key, value) {\n  if ((0, _isString2.default)(value) || (0, _isNumber2.default)(value)) return \"\".concat(key, \"=\").concat(value);\n  if ((0, _isString2.default)(value[0])) return \"\".concat(key, \"=\").concat(value.join(':'));\n  if (value && value.toString) return \"\".concat(key, \"=\").concat(value.toString());\n  return value.map(function (val) {\n    return arrayToStr(key, val);\n  });\n}\n\nfunction pickQueryParams(obj) {\n  return ['where', 'orderBy', 'limit', 'startAfter', 'startAt', 'endAt', 'endBefore'].reduce(function (acc, key) {\n    return obj[key] ? _objectSpread({}, acc, _defineProperty({}, key, obj[key])) : acc;\n  }, {});\n}\n\nfunction serialize(queryParams) {\n  return Object.keys(queryParams).filter(function (key) {\n    return queryParams[key] !== undefined;\n  }).map(function (key) {\n    return arrayToStr(key, queryParams[key]);\n  }).join('&');\n}\n\nfunction getQueryName(meta) {\n  if ((0, _isString2.default)(meta)) {\n    return meta;\n  }\n\n  var collection = meta.collection,\n      doc = meta.doc,\n      subcollections = meta.subcollections,\n      storeAs = meta.storeAs,\n      remainingMeta = _objectWithoutProperties(meta, [\"collection\", \"doc\", \"subcollections\", \"storeAs\"]);\n\n  if (!collection) {\n    throw new Error('Collection is required to build query name');\n  }\n\n  if (storeAs) {\n    return storeAs;\n  }\n\n  var basePath = collection;\n\n  if (doc) {\n    basePath = basePath.concat(\"/\".concat(doc));\n  }\n\n  if (subcollections) {\n    var mappedCollections = subcollections.map(function (subcollection) {\n      return getQueryName(subcollection);\n    });\n    basePath = \"\".concat(basePath, \"/\").concat(mappedCollections.join('/'));\n  }\n\n  var queryParams = pickQueryParams(remainingMeta);\n\n  if (!(0, _isEmpty2.default)(queryParams)) {\n    if (queryParams.where && !(0, _isArray2.default)(queryParams.where)) {\n      throw new Error('where parameter must be an array.');\n    }\n\n    basePath = basePath.concat('?', serialize(queryParams));\n  }\n\n  return basePath;\n}\n\nfunction getBaseQueryName(meta) {\n  if ((0, _isString2.default)(meta)) {\n    return meta;\n  }\n\n  var collection = meta.collection,\n      subcollections = meta.subcollections,\n      remainingMeta = _objectWithoutProperties(meta, [\"collection\", \"subcollections\"]);\n\n  if (!collection) {\n    throw new Error('Collection is required to build query name');\n  }\n\n  var basePath = collection;\n\n  if (subcollections) {\n    var mappedCollections = subcollections.map(function (subcollection) {\n      return getQueryName(subcollection);\n    });\n    basePath = \"\".concat(basePath, \"/\").concat(mappedCollections.join('/'));\n  }\n\n  var queryParams = pickQueryParams(remainingMeta);\n\n  if (!(0, _isEmpty2.default)(queryParams)) {\n    if (queryParams.where && !(0, _isArray2.default)(queryParams.where)) {\n      throw new Error('where parameter must be an array.');\n    }\n\n    basePath = basePath.concat('?', serialize(queryParams));\n  }\n\n  return basePath;\n}\n\nfunction confirmMetaAndConfig(firebase, meta) {\n  if (!meta) {\n    throw new Error('Meta data is required to attach listener.');\n  }\n\n  if (!(0, _has2.default)(firebase, '_.listeners')) {\n    throw new Error('Internal Firebase object required to attach listener. Confirm that reduxFirestore enhancer was added when you were creating your store');\n  }\n}\n\nfunction listenerExists(firebase, meta) {\n  confirmMetaAndConfig(firebase, meta);\n  var name = getQueryName(meta);\n  return !!firebase._.listeners[name];\n}\n\nfunction attachListener(firebase, dispatch, meta, unsubscribe) {\n  confirmMetaAndConfig(firebase, meta);\n  var name = getQueryName(meta);\n\n  if (!firebase._.listeners[name]) {\n    firebase._.listeners[name] = unsubscribe;\n  }\n\n  dispatch({\n    type: _constants.actionTypes.SET_LISTENER,\n    meta: meta,\n    payload: {\n      name: name\n    }\n  });\n  return firebase._.listeners;\n}\n\nfunction detachListener(firebase, dispatch, meta) {\n  var name = getQueryName(meta);\n\n  if (firebase._.listeners[name]) {\n    firebase._.listeners[name]();\n\n    delete firebase._.listeners[name];\n  }\n\n  dispatch({\n    type: _constants.actionTypes.UNSET_LISTENER,\n    meta: meta,\n    payload: {\n      name: name\n    }\n  });\n}\n\nfunction queryStrToObj(queryPathStr, parsedPath) {\n  var pathArr = parsedPath || (0, _trim2.default)(queryPathStr, ['/']).split('/');\n\n  var _pathArr = _toArray(pathArr),\n      collection = _pathArr[0],\n      doc = _pathArr[1],\n      subcollections = _pathArr.slice(2);\n\n  var queryObj = {};\n  if (collection) queryObj.collection = collection;\n  if (doc) queryObj.doc = doc;\n\n  if (subcollections.length) {\n    queryObj.subcollections = [queryStrToObj('', subcollections)];\n  }\n\n  return queryObj;\n}\n\nfunction getQueryConfig(query) {\n  if ((0, _isString2.default)(query)) {\n    return queryStrToObj(query);\n  }\n\n  if ((0, _isObject2.default)(query)) {\n    if (!query.collection && !query.doc) {\n      throw new Error('Collection and/or Doc are required parameters within query definition object.');\n    }\n\n    return query;\n  }\n\n  throw new Error('Invalid Path Definition: Only Strings and Objects are accepted.');\n}\n\nfunction getQueryConfigs(queries) {\n  if ((0, _isArray2.default)(queries)) {\n    return queries.map(getQueryConfig);\n  }\n\n  if ((0, _isString2.default)(queries)) {\n    return queryStrToObj(queries);\n  }\n\n  if ((0, _isObject2.default)(queries)) {\n    return [getQueryConfig(queries)];\n  }\n\n  throw new Error('Querie(s) must be an Array or a string.');\n}\n\nfunction orderedFromSnap(snap) {\n  var ordered = [];\n\n  if (snap.data && snap.exists) {\n    var obj = (0, _isObject2.default)(snap.data()) ? _objectSpread({\n      id: snap.id\n    }, snap.data() || snap.data) : {\n      id: snap.id,\n      data: snap.data()\n    };\n    ordered.push(obj);\n  } else if (snap.forEach) {\n    snap.forEach(function (doc) {\n      var obj = (0, _isObject2.default)(doc.data()) ? _objectSpread({\n        id: doc.id\n      }, doc.data() || doc.data) : {\n        id: doc.id,\n        data: doc.data()\n      };\n      ordered.push(obj);\n    });\n  }\n\n  return ordered;\n}\n\nfunction dataByIdSnapshot(snap) {\n  var data = {};\n\n  if (snap.data) {\n    data[snap.id] = snap.exists ? snap.data() : null;\n  } else if (snap.forEach) {\n    snap.forEach(function (doc) {\n      data[doc.id] = doc.data() || doc;\n    });\n  }\n\n  return (0, _size2.default)(data) ? data : null;\n}\n\nfunction getPopulateChild(firebase, populate, id) {\n  return firestoreRef(firebase, {\n    collection: populate.root,\n    doc: id\n  }).get().then(function (snap) {\n    return Object.assign({\n      id: id\n    }, snap.data());\n  });\n}\n\nfunction populateList(firebase, originalObj, p, results) {\n  if (!results[p.root]) {\n    (0, _set2.default)(results, p.root, {});\n  }\n\n  return Promise.all((0, _map2.default)(originalObj, function (id, childKey) {\n    var populateKey = id === true || p.populateByKey ? childKey : id;\n    return getPopulateChild(firebase, p, populateKey).then(function (pc) {\n      if (pc) {\n        return (0, _set2.default)(results, \"\".concat(p.root, \".\").concat(populateKey), pc);\n      }\n\n      return results;\n    });\n  }));\n}\n\nfunction getPopulateObj(str) {\n  if (!(0, _isString2.default)(str)) {\n    return str;\n  }\n\n  var strArray = str.split(':');\n  return {\n    child: strArray[0],\n    root: strArray[1]\n  };\n}\n\nfunction getPopulateObjs(arr) {\n  if (!(0, _isArray2.default)(arr)) {\n    return arr;\n  }\n\n  return arr.map(function (o) {\n    return (0, _isObject2.default)(o) ? o : getPopulateObj(o);\n  });\n}\n\nfunction promisesForPopulate(firebase, dataKey, originalData, populatesIn) {\n  var promisesArray = [];\n  var results = {};\n  var populatesForData = getPopulateObjs((0, _isFunction2.default)(populatesIn) ? populatesIn(dataKey, originalData) : populatesIn);\n  var dataHasPopulateChilds = (0, _some2.default)(populatesForData, function (populate) {\n    return (0, _has2.default)(originalData, populate.child);\n  });\n\n  if (dataHasPopulateChilds) {\n    (0, _forEach2.default)(populatesForData, function (p) {\n      if ((0, _isString2.default)((0, _get2.default)(originalData, p.child))) {\n        return promisesArray.push(getPopulateChild(firebase, p, (0, _get2.default)(originalData, p.child)).then(function (v) {\n          if (v) {\n            (0, _set2.default)(results, \"\".concat(p.root, \".\").concat((0, _get2.default)(originalData, p.child)), v);\n          }\n        }));\n      }\n\n      return promisesArray.push(populateList(firebase, (0, _get2.default)(originalData, p.child), p, results));\n    });\n  } else {\n    (0, _forEach2.default)(originalData, function (d, key) {\n      var populatesForDataItem = getPopulateObj((0, _isFunction2.default)(populatesIn) ? populatesIn(key, d) : populatesIn);\n      (0, _forEach2.default)(populatesForDataItem, function (p) {\n        var idOrList = (0, _get2.default)(d, p.child);\n\n        if (!idOrList) {\n          return;\n        }\n\n        if ((0, _isString2.default)(idOrList)) {\n          return promisesArray.push(getPopulateChild(firebase, p, idOrList).then(function (v) {\n            if (v) {\n              (0, _set2.default)(results, \"\".concat(p.root, \".\").concat(idOrList), v);\n            }\n\n            return results;\n          }));\n        }\n\n        if ((0, _isArray2.default)(idOrList) || (0, _isObject2.default)(idOrList)) {\n          return promisesArray.push(populateList(firebase, idOrList, p, results));\n        }\n      });\n    });\n  }\n\n  return Promise.all(promisesArray).then(function () {\n    return results;\n  });\n}\n\nvar changeTypeToEventType = {\n  added: _constants.actionTypes.DOCUMENT_ADDED,\n  removed: _constants.actionTypes.DOCUMENT_REMOVED,\n  modified: _constants.actionTypes.DOCUMENT_MODIFIED\n};\n\nfunction docChangeEvent(change) {\n  var originalMeta = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n  var meta = _objectSpread({}, (0, _cloneDeep2.default)(originalMeta), {\n    path: change.doc.ref.path\n  });\n\n  if (originalMeta.subcollections && !originalMeta.storeAs) {\n    meta.subcollections[0] = _objectSpread({}, meta.subcollections[0], {\n      doc: change.doc.id\n    });\n  } else {\n    meta.doc = change.doc.id;\n  }\n\n  return {\n    type: changeTypeToEventType[change.type] || _constants.actionTypes.DOCUMENT_MODIFIED,\n    meta: meta,\n    payload: {\n      data: change.doc.data(),\n      ordered: {\n        oldIndex: change.oldIndex,\n        newIndex: change.newIndex\n      }\n    }\n  };\n}\n\nfunction dispatchListenerResponse(_ref) {\n  var dispatch = _ref.dispatch,\n      docData = _ref.docData,\n      meta = _ref.meta,\n      firebase = _ref.firebase;\n\n  var _ref2 = firebase._.config || {},\n      mergeOrdered = _ref2.mergeOrdered,\n      mergeOrderedDocUpdates = _ref2.mergeOrderedDocUpdates,\n      mergeOrderedCollectionUpdates = _ref2.mergeOrderedCollectionUpdates;\n\n  var docChanges = typeof docData.docChanges === 'function' ? docData.docChanges() : docData.docChanges;\n\n  if (docChanges && docChanges.length < docData.size) {\n    docChanges.forEach(function (change) {\n      dispatch(docChangeEvent(change, meta));\n    });\n  } else {\n    dispatch({\n      type: _constants.actionTypes.LISTENER_RESPONSE,\n      meta: meta,\n      payload: {\n        data: dataByIdSnapshot(docData),\n        ordered: orderedFromSnap(docData)\n      },\n      merge: {\n        docs: mergeOrdered && mergeOrderedDocUpdates,\n        collections: mergeOrdered && mergeOrderedCollectionUpdates\n      }\n    });\n  }\n}\n\nfunction getPopulateActions(_ref3) {\n  var firebase = _ref3.firebase,\n      docData = _ref3.docData,\n      meta = _ref3.meta;\n  return promisesForPopulate(firebase, docData.id, dataByIdSnapshot(docData), meta.populates).then(function (populateResults) {\n    return Object.keys(populateResults).map(function (resultKey) {\n      return {\n        meta: {\n          collection: resultKey\n        },\n        payload: {\n          data: populateResults[resultKey]\n        },\n        requesting: false,\n        requested: true\n      };\n    });\n  }).catch(function (populateErr) {\n    console.error('Error with populate:', populateErr, meta);\n    return Promise.reject(populateErr);\n  });\n}","map":{"version":3,"sources":["/Users/JeHongHwang/Desktop/leekang/node_modules/redux-firestore/es/utils/query.js"],"names":["Object","defineProperty","exports","value","firestoreRef","getQueryName","getBaseQueryName","listenerExists","attachListener","detachListener","queryStrToObj","getQueryConfig","getQueryConfigs","orderedFromSnap","dataByIdSnapshot","getPopulateChild","populateList","promisesForPopulate","dispatchListenerResponse","getPopulateActions","_cloneDeep2","_interopRequireDefault","require","_some2","_set2","_get2","_map2","_has2","_forEach2","_trim2","_size2","_isEmpty2","_isNumber2","_isObject2","_isFunction2","_isArray2","_isString2","_constants","obj","__esModule","default","_toArray","arr","_arrayWithHoles","_iterableToArray","_nonIterableRest","TypeError","Array","isArray","_objectWithoutProperties","source","excluded","target","_objectWithoutPropertiesLoose","key","i","getOwnPropertySymbols","sourceSymbolKeys","length","indexOf","prototype","propertyIsEnumerable","call","sourceKeys","keys","_objectSpread","arguments","ownKeys","concat","filter","sym","getOwnPropertyDescriptor","enumerable","forEach","_defineProperty","configurable","writable","_toConsumableArray","_arrayWithoutHoles","_nonIterableSpread","iter","Symbol","iterator","toString","from","arr2","addWhereToRef","ref","where","Error","apply","reduce","acc","whereArgs","addOrderByToRef","orderBy","orderByArgs","handleSubcollections","subcollectionList","subcollection","collection","doc","limit","startAt","startAfter","endAt","endBefore","subcollections","firebase","meta","firestore","arrayToStr","join","map","val","pickQueryParams","serialize","queryParams","undefined","storeAs","remainingMeta","basePath","mappedCollections","confirmMetaAndConfig","name","_","listeners","dispatch","unsubscribe","type","actionTypes","SET_LISTENER","payload","UNSET_LISTENER","queryPathStr","parsedPath","pathArr","split","_pathArr","slice","queryObj","query","queries","snap","ordered","data","exists","id","push","populate","root","get","then","assign","originalObj","p","results","Promise","all","childKey","populateKey","populateByKey","pc","getPopulateObj","str","strArray","child","getPopulateObjs","o","dataKey","originalData","populatesIn","promisesArray","populatesForData","dataHasPopulateChilds","v","d","populatesForDataItem","idOrList","changeTypeToEventType","added","DOCUMENT_ADDED","removed","DOCUMENT_REMOVED","modified","DOCUMENT_MODIFIED","docChangeEvent","change","originalMeta","path","oldIndex","newIndex","_ref","docData","_ref2","config","mergeOrdered","mergeOrderedDocUpdates","mergeOrderedCollectionUpdates","docChanges","size","LISTENER_RESPONSE","merge","docs","collections","_ref3","populates","populateResults","resultKey","requesting","requested","catch","populateErr","console","error","reject"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.firestoreRef = firestoreRef;\nexports.getQueryName = getQueryName;\nexports.getBaseQueryName = getBaseQueryName;\nexports.listenerExists = listenerExists;\nexports.attachListener = attachListener;\nexports.detachListener = detachListener;\nexports.queryStrToObj = queryStrToObj;\nexports.getQueryConfig = getQueryConfig;\nexports.getQueryConfigs = getQueryConfigs;\nexports.orderedFromSnap = orderedFromSnap;\nexports.dataByIdSnapshot = dataByIdSnapshot;\nexports.getPopulateChild = getPopulateChild;\nexports.populateList = populateList;\nexports.promisesForPopulate = promisesForPopulate;\nexports.dispatchListenerResponse = dispatchListenerResponse;\nexports.getPopulateActions = getPopulateActions;\n\nvar _cloneDeep2 = _interopRequireDefault(require(\"lodash/cloneDeep\"));\n\nvar _some2 = _interopRequireDefault(require(\"lodash/some\"));\n\nvar _set2 = _interopRequireDefault(require(\"lodash/set\"));\n\nvar _get2 = _interopRequireDefault(require(\"lodash/get\"));\n\nvar _map2 = _interopRequireDefault(require(\"lodash/map\"));\n\nvar _has2 = _interopRequireDefault(require(\"lodash/has\"));\n\nvar _forEach2 = _interopRequireDefault(require(\"lodash/forEach\"));\n\nvar _trim2 = _interopRequireDefault(require(\"lodash/trim\"));\n\nvar _size2 = _interopRequireDefault(require(\"lodash/size\"));\n\nvar _isEmpty2 = _interopRequireDefault(require(\"lodash/isEmpty\"));\n\nvar _isNumber2 = _interopRequireDefault(require(\"lodash/isNumber\"));\n\nvar _isObject2 = _interopRequireDefault(require(\"lodash/isObject\"));\n\nvar _isFunction2 = _interopRequireDefault(require(\"lodash/isFunction\"));\n\nvar _isArray2 = _interopRequireDefault(require(\"lodash/isArray\"));\n\nvar _isString2 = _interopRequireDefault(require(\"lodash/isString\"));\n\nvar _constants = require(\"../constants\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _toArray(arr) { return _arrayWithHoles(arr) || _iterableToArray(arr) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance\"); }\n\nfunction _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }\n\nfunction addWhereToRef(ref, where) {\n  if (!(0, _isArray2.default)(where)) {\n    throw new Error('where parameter must be an array.');\n  }\n\n  if ((0, _isString2.default)(where[0])) {\n    return where.length > 1 ? ref.where.apply(ref, _toConsumableArray(where)) : ref.where(where[0]);\n  }\n\n  return where.reduce(function (acc, whereArgs) {\n    return addWhereToRef(acc, whereArgs);\n  }, ref);\n}\n\nfunction addOrderByToRef(ref, orderBy) {\n  if (!(0, _isArray2.default)(orderBy) && !(0, _isString2.default)(orderBy)) {\n    throw new Error('orderBy parameter must be an array or string.');\n  }\n\n  if ((0, _isString2.default)(orderBy)) {\n    return ref.orderBy(orderBy);\n  }\n\n  if ((0, _isString2.default)(orderBy[0])) {\n    return ref.orderBy.apply(ref, _toConsumableArray(orderBy));\n  }\n\n  return orderBy.reduce(function (acc, orderByArgs) {\n    return addOrderByToRef(acc, orderByArgs);\n  }, ref);\n}\n\nfunction handleSubcollections(ref, subcollectionList) {\n  if (subcollectionList) {\n    (0, _forEach2.default)(subcollectionList, function (subcollection) {\n      if (subcollection.collection) {\n        if (!(0, _isFunction2.default)(ref.collection)) {\n          throw new Error(\"Collection can only be run on a document. Check that query config for subcollection: \\\"\".concat(subcollection.collection, \"\\\" contains a doc parameter.\"));\n        }\n\n        ref = ref.collection(subcollection.collection);\n      }\n\n      if (subcollection.doc) ref = ref.doc(subcollection.doc);\n      if (subcollection.where) ref = addWhereToRef(ref, subcollection.where);\n\n      if (subcollection.orderBy) {\n        ref = addOrderByToRef(ref, subcollection.orderBy);\n      }\n\n      if (subcollection.limit) ref = ref.limit(subcollection.limit);\n      if (subcollection.startAt) ref = ref.startAt(subcollection.startAt);\n\n      if (subcollection.startAfter) {\n        ref = ref.startAfter(subcollection.startAfter);\n      }\n\n      if (subcollection.endAt) ref = ref.endAt(subcollection.endAt);\n      if (subcollection.endBefore) ref = ref.endBefore(subcollection.endBefore);\n      ref = handleSubcollections(ref, subcollection.subcollections);\n    });\n  }\n\n  return ref;\n}\n\nfunction firestoreRef(firebase, meta) {\n  if (!firebase.firestore) {\n    throw new Error('Firestore must be required and initalized.');\n  }\n\n  var collection = meta.collection,\n      doc = meta.doc,\n      subcollections = meta.subcollections,\n      where = meta.where,\n      orderBy = meta.orderBy,\n      limit = meta.limit,\n      startAt = meta.startAt,\n      startAfter = meta.startAfter,\n      endAt = meta.endAt,\n      endBefore = meta.endBefore;\n  var ref = firebase.firestore().collection(collection);\n  if (doc) ref = ref.doc(doc);\n  ref = handleSubcollections(ref, subcollections);\n  if (where) ref = addWhereToRef(ref, where);\n  if (orderBy) ref = addOrderByToRef(ref, orderBy);\n  if (limit) ref = ref.limit(limit);\n  if (startAt) ref = ref.startAt(startAt);\n  if (startAfter) ref = ref.startAfter(startAfter);\n  if (endAt) ref = ref.endAt(endAt);\n  if (endBefore) ref = ref.endBefore(endBefore);\n  return ref;\n}\n\nfunction arrayToStr(key, value) {\n  if ((0, _isString2.default)(value) || (0, _isNumber2.default)(value)) return \"\".concat(key, \"=\").concat(value);\n  if ((0, _isString2.default)(value[0])) return \"\".concat(key, \"=\").concat(value.join(':'));\n  if (value && value.toString) return \"\".concat(key, \"=\").concat(value.toString());\n  return value.map(function (val) {\n    return arrayToStr(key, val);\n  });\n}\n\nfunction pickQueryParams(obj) {\n  return ['where', 'orderBy', 'limit', 'startAfter', 'startAt', 'endAt', 'endBefore'].reduce(function (acc, key) {\n    return obj[key] ? _objectSpread({}, acc, _defineProperty({}, key, obj[key])) : acc;\n  }, {});\n}\n\nfunction serialize(queryParams) {\n  return Object.keys(queryParams).filter(function (key) {\n    return queryParams[key] !== undefined;\n  }).map(function (key) {\n    return arrayToStr(key, queryParams[key]);\n  }).join('&');\n}\n\nfunction getQueryName(meta) {\n  if ((0, _isString2.default)(meta)) {\n    return meta;\n  }\n\n  var collection = meta.collection,\n      doc = meta.doc,\n      subcollections = meta.subcollections,\n      storeAs = meta.storeAs,\n      remainingMeta = _objectWithoutProperties(meta, [\"collection\", \"doc\", \"subcollections\", \"storeAs\"]);\n\n  if (!collection) {\n    throw new Error('Collection is required to build query name');\n  }\n\n  if (storeAs) {\n    return storeAs;\n  }\n\n  var basePath = collection;\n\n  if (doc) {\n    basePath = basePath.concat(\"/\".concat(doc));\n  }\n\n  if (subcollections) {\n    var mappedCollections = subcollections.map(function (subcollection) {\n      return getQueryName(subcollection);\n    });\n    basePath = \"\".concat(basePath, \"/\").concat(mappedCollections.join('/'));\n  }\n\n  var queryParams = pickQueryParams(remainingMeta);\n\n  if (!(0, _isEmpty2.default)(queryParams)) {\n    if (queryParams.where && !(0, _isArray2.default)(queryParams.where)) {\n      throw new Error('where parameter must be an array.');\n    }\n\n    basePath = basePath.concat('?', serialize(queryParams));\n  }\n\n  return basePath;\n}\n\nfunction getBaseQueryName(meta) {\n  if ((0, _isString2.default)(meta)) {\n    return meta;\n  }\n\n  var collection = meta.collection,\n      subcollections = meta.subcollections,\n      remainingMeta = _objectWithoutProperties(meta, [\"collection\", \"subcollections\"]);\n\n  if (!collection) {\n    throw new Error('Collection is required to build query name');\n  }\n\n  var basePath = collection;\n\n  if (subcollections) {\n    var mappedCollections = subcollections.map(function (subcollection) {\n      return getQueryName(subcollection);\n    });\n    basePath = \"\".concat(basePath, \"/\").concat(mappedCollections.join('/'));\n  }\n\n  var queryParams = pickQueryParams(remainingMeta);\n\n  if (!(0, _isEmpty2.default)(queryParams)) {\n    if (queryParams.where && !(0, _isArray2.default)(queryParams.where)) {\n      throw new Error('where parameter must be an array.');\n    }\n\n    basePath = basePath.concat('?', serialize(queryParams));\n  }\n\n  return basePath;\n}\n\nfunction confirmMetaAndConfig(firebase, meta) {\n  if (!meta) {\n    throw new Error('Meta data is required to attach listener.');\n  }\n\n  if (!(0, _has2.default)(firebase, '_.listeners')) {\n    throw new Error('Internal Firebase object required to attach listener. Confirm that reduxFirestore enhancer was added when you were creating your store');\n  }\n}\n\nfunction listenerExists(firebase, meta) {\n  confirmMetaAndConfig(firebase, meta);\n  var name = getQueryName(meta);\n  return !!firebase._.listeners[name];\n}\n\nfunction attachListener(firebase, dispatch, meta, unsubscribe) {\n  confirmMetaAndConfig(firebase, meta);\n  var name = getQueryName(meta);\n\n  if (!firebase._.listeners[name]) {\n    firebase._.listeners[name] = unsubscribe;\n  }\n\n  dispatch({\n    type: _constants.actionTypes.SET_LISTENER,\n    meta: meta,\n    payload: {\n      name: name\n    }\n  });\n  return firebase._.listeners;\n}\n\nfunction detachListener(firebase, dispatch, meta) {\n  var name = getQueryName(meta);\n\n  if (firebase._.listeners[name]) {\n    firebase._.listeners[name]();\n\n    delete firebase._.listeners[name];\n  }\n\n  dispatch({\n    type: _constants.actionTypes.UNSET_LISTENER,\n    meta: meta,\n    payload: {\n      name: name\n    }\n  });\n}\n\nfunction queryStrToObj(queryPathStr, parsedPath) {\n  var pathArr = parsedPath || (0, _trim2.default)(queryPathStr, ['/']).split('/');\n\n  var _pathArr = _toArray(pathArr),\n      collection = _pathArr[0],\n      doc = _pathArr[1],\n      subcollections = _pathArr.slice(2);\n\n  var queryObj = {};\n  if (collection) queryObj.collection = collection;\n  if (doc) queryObj.doc = doc;\n\n  if (subcollections.length) {\n    queryObj.subcollections = [queryStrToObj('', subcollections)];\n  }\n\n  return queryObj;\n}\n\nfunction getQueryConfig(query) {\n  if ((0, _isString2.default)(query)) {\n    return queryStrToObj(query);\n  }\n\n  if ((0, _isObject2.default)(query)) {\n    if (!query.collection && !query.doc) {\n      throw new Error('Collection and/or Doc are required parameters within query definition object.');\n    }\n\n    return query;\n  }\n\n  throw new Error('Invalid Path Definition: Only Strings and Objects are accepted.');\n}\n\nfunction getQueryConfigs(queries) {\n  if ((0, _isArray2.default)(queries)) {\n    return queries.map(getQueryConfig);\n  }\n\n  if ((0, _isString2.default)(queries)) {\n    return queryStrToObj(queries);\n  }\n\n  if ((0, _isObject2.default)(queries)) {\n    return [getQueryConfig(queries)];\n  }\n\n  throw new Error('Querie(s) must be an Array or a string.');\n}\n\nfunction orderedFromSnap(snap) {\n  var ordered = [];\n\n  if (snap.data && snap.exists) {\n    var obj = (0, _isObject2.default)(snap.data()) ? _objectSpread({\n      id: snap.id\n    }, snap.data() || snap.data) : {\n      id: snap.id,\n      data: snap.data()\n    };\n    ordered.push(obj);\n  } else if (snap.forEach) {\n    snap.forEach(function (doc) {\n      var obj = (0, _isObject2.default)(doc.data()) ? _objectSpread({\n        id: doc.id\n      }, doc.data() || doc.data) : {\n        id: doc.id,\n        data: doc.data()\n      };\n      ordered.push(obj);\n    });\n  }\n\n  return ordered;\n}\n\nfunction dataByIdSnapshot(snap) {\n  var data = {};\n\n  if (snap.data) {\n    data[snap.id] = snap.exists ? snap.data() : null;\n  } else if (snap.forEach) {\n    snap.forEach(function (doc) {\n      data[doc.id] = doc.data() || doc;\n    });\n  }\n\n  return (0, _size2.default)(data) ? data : null;\n}\n\nfunction getPopulateChild(firebase, populate, id) {\n  return firestoreRef(firebase, {\n    collection: populate.root,\n    doc: id\n  }).get().then(function (snap) {\n    return Object.assign({\n      id: id\n    }, snap.data());\n  });\n}\n\nfunction populateList(firebase, originalObj, p, results) {\n  if (!results[p.root]) {\n    (0, _set2.default)(results, p.root, {});\n  }\n\n  return Promise.all((0, _map2.default)(originalObj, function (id, childKey) {\n    var populateKey = id === true || p.populateByKey ? childKey : id;\n    return getPopulateChild(firebase, p, populateKey).then(function (pc) {\n      if (pc) {\n        return (0, _set2.default)(results, \"\".concat(p.root, \".\").concat(populateKey), pc);\n      }\n\n      return results;\n    });\n  }));\n}\n\nfunction getPopulateObj(str) {\n  if (!(0, _isString2.default)(str)) {\n    return str;\n  }\n\n  var strArray = str.split(':');\n  return {\n    child: strArray[0],\n    root: strArray[1]\n  };\n}\n\nfunction getPopulateObjs(arr) {\n  if (!(0, _isArray2.default)(arr)) {\n    return arr;\n  }\n\n  return arr.map(function (o) {\n    return (0, _isObject2.default)(o) ? o : getPopulateObj(o);\n  });\n}\n\nfunction promisesForPopulate(firebase, dataKey, originalData, populatesIn) {\n  var promisesArray = [];\n  var results = {};\n  var populatesForData = getPopulateObjs((0, _isFunction2.default)(populatesIn) ? populatesIn(dataKey, originalData) : populatesIn);\n  var dataHasPopulateChilds = (0, _some2.default)(populatesForData, function (populate) {\n    return (0, _has2.default)(originalData, populate.child);\n  });\n\n  if (dataHasPopulateChilds) {\n    (0, _forEach2.default)(populatesForData, function (p) {\n      if ((0, _isString2.default)((0, _get2.default)(originalData, p.child))) {\n        return promisesArray.push(getPopulateChild(firebase, p, (0, _get2.default)(originalData, p.child)).then(function (v) {\n          if (v) {\n            (0, _set2.default)(results, \"\".concat(p.root, \".\").concat((0, _get2.default)(originalData, p.child)), v);\n          }\n        }));\n      }\n\n      return promisesArray.push(populateList(firebase, (0, _get2.default)(originalData, p.child), p, results));\n    });\n  } else {\n    (0, _forEach2.default)(originalData, function (d, key) {\n      var populatesForDataItem = getPopulateObj((0, _isFunction2.default)(populatesIn) ? populatesIn(key, d) : populatesIn);\n      (0, _forEach2.default)(populatesForDataItem, function (p) {\n        var idOrList = (0, _get2.default)(d, p.child);\n\n        if (!idOrList) {\n          return;\n        }\n\n        if ((0, _isString2.default)(idOrList)) {\n          return promisesArray.push(getPopulateChild(firebase, p, idOrList).then(function (v) {\n            if (v) {\n              (0, _set2.default)(results, \"\".concat(p.root, \".\").concat(idOrList), v);\n            }\n\n            return results;\n          }));\n        }\n\n        if ((0, _isArray2.default)(idOrList) || (0, _isObject2.default)(idOrList)) {\n          return promisesArray.push(populateList(firebase, idOrList, p, results));\n        }\n      });\n    });\n  }\n\n  return Promise.all(promisesArray).then(function () {\n    return results;\n  });\n}\n\nvar changeTypeToEventType = {\n  added: _constants.actionTypes.DOCUMENT_ADDED,\n  removed: _constants.actionTypes.DOCUMENT_REMOVED,\n  modified: _constants.actionTypes.DOCUMENT_MODIFIED\n};\n\nfunction docChangeEvent(change) {\n  var originalMeta = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n  var meta = _objectSpread({}, (0, _cloneDeep2.default)(originalMeta), {\n    path: change.doc.ref.path\n  });\n\n  if (originalMeta.subcollections && !originalMeta.storeAs) {\n    meta.subcollections[0] = _objectSpread({}, meta.subcollections[0], {\n      doc: change.doc.id\n    });\n  } else {\n    meta.doc = change.doc.id;\n  }\n\n  return {\n    type: changeTypeToEventType[change.type] || _constants.actionTypes.DOCUMENT_MODIFIED,\n    meta: meta,\n    payload: {\n      data: change.doc.data(),\n      ordered: {\n        oldIndex: change.oldIndex,\n        newIndex: change.newIndex\n      }\n    }\n  };\n}\n\nfunction dispatchListenerResponse(_ref) {\n  var dispatch = _ref.dispatch,\n      docData = _ref.docData,\n      meta = _ref.meta,\n      firebase = _ref.firebase;\n\n  var _ref2 = firebase._.config || {},\n      mergeOrdered = _ref2.mergeOrdered,\n      mergeOrderedDocUpdates = _ref2.mergeOrderedDocUpdates,\n      mergeOrderedCollectionUpdates = _ref2.mergeOrderedCollectionUpdates;\n\n  var docChanges = typeof docData.docChanges === 'function' ? docData.docChanges() : docData.docChanges;\n\n  if (docChanges && docChanges.length < docData.size) {\n    docChanges.forEach(function (change) {\n      dispatch(docChangeEvent(change, meta));\n    });\n  } else {\n    dispatch({\n      type: _constants.actionTypes.LISTENER_RESPONSE,\n      meta: meta,\n      payload: {\n        data: dataByIdSnapshot(docData),\n        ordered: orderedFromSnap(docData)\n      },\n      merge: {\n        docs: mergeOrdered && mergeOrderedDocUpdates,\n        collections: mergeOrdered && mergeOrderedCollectionUpdates\n      }\n    });\n  }\n}\n\nfunction getPopulateActions(_ref3) {\n  var firebase = _ref3.firebase,\n      docData = _ref3.docData,\n      meta = _ref3.meta;\n  return promisesForPopulate(firebase, docData.id, dataByIdSnapshot(docData), meta.populates).then(function (populateResults) {\n    return Object.keys(populateResults).map(function (resultKey) {\n      return {\n        meta: {\n          collection: resultKey\n        },\n        payload: {\n          data: populateResults[resultKey]\n        },\n        requesting: false,\n        requested: true\n      };\n    });\n  }).catch(function (populateErr) {\n    console.error('Error with populate:', populateErr, meta);\n    return Promise.reject(populateErr);\n  });\n}"]},"metadata":{},"sourceType":"script"}